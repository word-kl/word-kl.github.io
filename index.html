<！doctype html>
<超文本标记语言>

<头>
    <元字符集="UTF-8">
    <元姓名="视口" 内容="宽度=设备宽度，初始比例=1.0">
    <标题>403</标题>
    <风格>
*{
            边缘:0;
            填充:0;
            箱体尺寸:边框框;
        }

身体{
            边缘:0;
            溢出:隐藏的;
            背景: #000;
        }

帆布{
            位置:绝对的;
            宽度:100%;
            高度:100%;
            指针事件:没有一个;
        }

#controlPanel{
            位置:绝对的;
            Z指数:1000;
            顶端:50%;
            左:50%;
            改变:翻译(-50%,-50%);
            背景:RGBA(0,0,0,0.8);
            填充:25PX;
            边境:2PX 固体 RGBA(255,77,77,0.5);
            边界半径:10PX;
            箱形阴影:0 0 20PX RGBA(255,77,77,0.3);
            最大宽度:70%;
            宽度:250PX;
            显示:弯曲;
            挠曲方向:柱;
            justify-content:中心;
            对齐项目:中心;
            过渡:所有 0.3s 缓解;
        }

#controlPanel.button-container{
            显示:弯曲;
            justify-content:环绕空间的;
            宽度:100%;
            柔性缠绕:包;
        }

#controlPanel按钮{
            宽度:自动;
            边缘:10PX;
        }

#祝福{
            颜色：#fff；
            字体大小:16PX;
            线高:1.6;
            文本对齐:中心;
            颜色：#f7e77d；
        }

.play-button{
            背景色：#ffc0cb；
            颜色:白色的;
            边境:没有一个;
            填充:10PX 20PX;
            上边距:10PX;
            边界半径:5PX;
            光标:指针;
            字体大小:18PX;
            字体粗细:大胆的;
            文本阴影:1PX 1PX 2PX RGBA(0,0,0,0.5);
            箱形阴影:0 4PX 6PX RGBA(0,0,0,0.3);
            transition: all 0.3s ease;
        }

    .play-button:hover {
            background-color: #e65c00;
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.4);
            transform: translateY(-2px);
        }

    .hidden {
            display: none;
        }

    .message-popup {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border: 2px solid rgba(255, 77, 77, 0.5);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 77, 77, 0.3);
            z-index: 1001;
            text-align: center;
        }
    </style>
</head>

<body>
    <div id="controlPanel">
        <div id="blessings" class="hidden"></div>
        <div class="message-popup hidden" id="niceMessage">希望2025年你打多一点哦！</div>
<        <div class="message-popup hidden" id="startMessage">开启2025年第一炮啦，祝你蛇蛇蛇！</div>class="message-popup hidden"id="startMessage">开启2025年第一炮啦，祝你蛇蛇蛇！</div>
        <div class="button-container">
            <button class="play-button" id="beNiceButton" onclick="showStartButton()">2025年我打多一点</button>
            <按钮班级="播放按钮已隐藏" 身份标识="StartButton" onClick="start2025()">开启2025年第一次炮</按钮>
            <按钮班级="播放按钮" 身份标识="playMusicButton" onClick="PlayMusic()">播放音乐</按钮>
            <按钮班级="播放按钮" 身份标识="pauseMusicButton" onClick="pauseMusic()">暂停音乐</按钮>
        </div>
    </div>
    <帆布身份标识="backgroundCanvas" 班级="隐藏"></帆布>
    <帆布身份标识="mainCanvas" 班级="隐藏"></帆布>
    <帆布身份标识="permanentFireworkCanvas" 班级="隐藏"></帆布>
    <音频身份标识="FireworkSound" 自动播放 班级="隐藏">
        <来源src="久石茫-Summer.mp3" 类型="音频/mpeg">
        <来源src="久石茫-Summer.ogg" 类型="音频/ogg">
        <来源src="久石茫-Summer.wav" 类型="音频/wav">
    </音频>
    <脚本>
        Const 祝福=`蛇年，蛇蛇蛇！ 403人人大蛇，蛇出精彩，扣6勾巴长长10cm，林柏志除外，因为他的已经够长了`;

        Const 祝福Div=文档。getElementById(“祝福”);
        Const beNiceButton=文档。getElementById('BeNiceButton');
        Const StartButton=文档。getElementById('StartButton');
        Const niceMessage=文档。getElementById('niceMessage');
        Const startMessage=文档。getElementById('startMessage');
        Const 背景画布=文档。getElementById('backgroundCanvas');
        Const bgCtx=backgroundCanvas。getContext('2d');
        Const mainCanvas=文档。getElementById('主要画布');
        Const mainCtx=mainCanvas。getContext('2d');
        Const permanentFireworkCanvas=文档。getElementById('permanentFireworkCanvas');
        Const permanentFireworkCtx=permanentFireworkCanvas。getContext('2d');
        Const fireworkSound=文档。getElementById('FireworkSound');
        Const playMusicButton=文档。getElementById('PlayMusicButton');
        Const pauseMusicButton=文档。getElementById('pauseMusicButton');

        功能 resizeCanvas(canvas1,canvas2,canvas3) {
            让 宽度=窗口。innerWidth;
            让 高度=窗口。innerHeight;
            Const minWidth=320;
            Const minHeight=480;
            如果 (宽度<最小宽度) {
width=minWidth；
            }
            如果 (高度<最小高度) {
height=minHeight；
            }
            Const maxWidth=1920;
            Const maxHeight=1080;
            如果 (宽度>最大宽度) {
width=maxWidth；
            }
            如果 (高度>maxHeight) {
height=maxHeight；
            }
canvas1.宽度=宽度；
canvas1.高度=高度；
canvas2.宽度=宽度；
canvas2.高度=高度；
canvas3.宽度=宽度；
canvas3.高度=高度；
        }

窗户。addEventListener('调整大小',()=>{
            resizeCanvas(backgroundCanvas，mainCanvas，permanentFireworkCanvas);
        });

        班级烟火{
            构造函数() {
                让 screenRatio=窗口。innerWidth/窗口。innerHeight;
                这.x=数学。随机()*背景画布。宽度*(screenRatio>1.5?0.8:0.5);
                这.y=backgroundCanvas。高度;
                这.targety=数学。随机()*背景画布。高度/2;
                这.速度=数学。随机()*6+3;
                这.角=-math。Pi/2+(数学。随机()-0.5)*数学。Pi/6;
                这.粒子=[];
                这.已分解=假的;
                这.颜色='hsl(${数学。随机()*360}, 100%, 50%)`;
            }
            // 修正类方法定义
            更新() {
                如果 (!这.已分解) {
                    这.x+=数学Cos(这.角)*这.速度;
                    这.y+=数学罪恶(这.角)*这.速度;
                    如果 (这.y<=这.targety) {
                        这.爆炸();
                    }
                }
                为 (让 我=这.粒子.长度-1；i>=0；i--) {
                    这.粒子[我].更新();
                    如果 (这.粒子[我].isdead()) {
                        这.粒子.拼接(我，1);
                    }
                }
            }
            爆炸() {
                这.已分解=正确;
                Const 粒子计数=200;
                为 (让 我=0；i<粒子计数；i++) {
                    Const 角=数学。随机()*2*数学。Pi;
                    Const 速度=数学。随机()*4+1;
                    这.粒子.推(新的颗粒(这.x,这.y,这.颜色、角度、速度));
                }
            }
            画(CTX) {
                如果 (!这.已分解) {
CTX.beginPath();
CTX.弧(这.x,这.y,3,0，数学。Pi*2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
                for (let i = 0; i < this.particles.length; i++) {
                    if (!this.particles[i].isDead()) {
                        this.particles[i].draw(ctx);
                    }
                }
            }
        }

        class Particle {
            constructor(x, y, color, angle, speed) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.alpha = 1;
                this.decay = Math.random() * 0.015 + 0.005;
                this.size = Math.random() * 3 + 1;
                this.life = 100;
                this.ax = (Math.random() - 0.5) * 0.1;
                this.ay = 0.05;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
            }

            update() {
                this.vx += this.ax;
                this.vy += this.ay;
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= this.decay;
                this.life--;
            }

            draw(ctx) {
                ctx.save();
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }

            isDead() {
                return this.alpha <= 0 || this.life <= 0;
            }
        }

        class Snowflake {
            constructor() {
                this.x = Math.random() * mainCanvas.width;
                this.y = Math.random() * mainCanvas.height;
                this.speed = Math.random() * 1 + 0.5;
                this.size = Math.random() * 3 + 1;
                this.opacity = Math.random() * 0.5 + 0.5;
                this.wind = Math.random() * 0.5 - 0.25;
                this.rotation = Math.random() * 360;
                this.rotationSpeed = Math.random() * 1 - 0.5;
            }

            update() {
                this.y += this.speed;
                this.x += this.wind;
                this.rotation += this.rotationSpeed;
                if (this.y > mainCanvas.height) {
                    this.y = -this.size;
                    this.x = Math.random() * mainCanvas.width;
                }
                if (this.x > mainCanvas.width || this.x < 0) {
                    this.x = Math.random() * mainCanvas.width;
                }
            }

            draw(ctx) {
                ctx.save();
                ctx.globalAlpha = this.opacity;
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation * Math.PI / 180);
                ctx.fillStyle = `rgba(255, 255, 250, ${this.opacity})`;
                ctx.beginPath();
                ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        let fireworks = [];
        let snowflakes = [];
        let lastFireworkTime = 0;
        let lastSnowflakeTime = 0;
        let FIREWORK_INTERVAL = 500;
        if (window.innerWidth < 600) {
            FIREWORK_INTERVAL = 1000;
        }
        const SNOWFLAKE_INTERVAL = 50;

        function createObjects(objects, interval, lastTime, objectClass, canvas) {
            const currentTime = Date.now();
            if (currentTime - lastTime > interval) {
                objects.push(new objectClass());
                return Date.now();
            }
            return lastTime;
        }

        function animate() {
            permanentFireworkCtx.clearRect(0, 0, permanentFireworkCanvas.width, permanentFireworkCanvas.height);

            bgCtx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            bgCtx.fillRect(0, 0, backgroundCanvas.width, backgroundCanvas.height);
            lastFireworkTime = createObjects(fireworks, FIREWORK_INTERVAL, lastFireworkTime, Firework, backgroundCanvas);
            for (let i = fireworks.length - 1; i >= 0; i--) {
                fireworks[i].update();
                if (fireworks[i].exploded && fireworks[i].particles.length === 0) {
                    fireworks.splice(i, 1);
                } else {
                    fireworks[i].draw(bgCtx);
                }
            }


            mainCtx.clearRect(0, 0, mainCanvas.width, mainCanvas.height);
            lastSnowflakeTime = createObjects(snowflakes, SNOWFLAKE_INTERVAL, lastSnowflakeTime, Snowflake, mainCanvas);
            for (let i = snowflakes.length - 1; i >= 0; i--) {
                snowflakes[i].update();
                snowflakes[i].draw(mainCtx);
            }


            requestAnimationFrame(animate);
        }


        function showStartButton() {
            beNiceButton.classList.add('hidden');
            startButton.classList.remove('hidden');
            niceMessage.classList.remove('hidden');
            setTimeout(() => {
                niceMessage.classList.add('hidden');
            }, 1000);
        }

        function start2025() {
            blessingsDiv.innerHTML = `2025年蛇年快乐<br><br>${blessing.replace(/\n/g, '<br>')}`;
            blessingsDiv.classList.remove('hidden');
            startButton.classList.add('hidden');
            startMessage.classList.remove('hidden');
            backgroundCanvas.classList.remove('hidden');
            mainCanvas.classList.remove('hidden');
            permanentFireworkCanvas.classList.remove('hidden');
            fireworkSound.classList.remove('hidden');
            // 修正 resizeCanvas 函数调用
            resizeCanvas(backgroundCanvas, mainCanvas, permanentFireworkCanvas);
            animate();
            setTimeout(() => {
                startMessage.classList.add('hidden');
            }, 3000);
        }

        // 兼容性处理 requestAnimationFrame
        (function () {
            var lastTime = 0;
            var vendors = ['webkit','moz','ms','o'];
            for (var x = 0; x < vendors.length &&!window.requestAnimationFrame; ++x) {
                window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
                window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];
            }

            if (!window.requestAnimationFrame)
                window.requestAnimationFrame = function (callback, element) {
                    var currTime = new Date().getTime();
                    var timeToCall = Math.max(0, 16 - (currTime - lastTime));
                    var id = window.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);
                    lastTime = currTime + timeToCall;
                    return id;
                };

            if (!window.cancelAnimationFrame)
                window.cancelAnimationFrame = function (id) {
                    clearTimeout(id);
                };
        }());

        // 播放音乐函数
        function playMusic() {
            if (fireworkSound.readyState === 4) {
                fireworkSound.play();
            } else {
                fireworkSound.addEventListener('canplaythrough', function () {
                    fireworkSound.play();
                });
            }
        }

        // 暂停音乐函数
        function pauseMusic() {
            fireworkSound.pause();
        }
    </script>
</body>

</html>
